<!DOCTYPE html>
<html lang="es-MX">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>DÍA VIP - Gira y Gana</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --pink:#ff75e2;
  --bg:#121125;
  --stroke: rgba(255,255,255,.12);
  --text:#f5f7ff;
  --red:#ff4d4d;
  --shadow: 0 22px 60px rgba(0,0,0,.55);

  /* ✅ responsive sizing */
  --card: clamp(96px, 24vw, 150px);
  --card-gap: clamp(8px, 2.8vw, 12px);
  --carousel-h: clamp(130px, 28vw, 180px);
}

*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; margin:0; }

body{
  background:
    radial-gradient(900px 520px at 50% -10%, rgba(255,117,226,.18), transparent 60%),
    var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: system-ui, -apple-system, sans-serif;
  color:var(--text);
  padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right)) max(12px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
}

.shell{
  width:95%;
  max-width:800px;
  border:1px solid var(--stroke);
  border-radius:32px;
  box-shadow:var(--shadow);
  overflow:hidden;
  background:rgba(255,255,255,.04);
}

.header{
  text-align:center;
  padding:24px 15px 10px;
}

.header h1{
  margin:0;
  font-size: clamp(22px, 6vw, 40px);
  background: linear-gradient(180deg, #fff, var(--pink));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.main{ padding:20px; }

.carousel-container{
  position:relative;
  height:var(--carousel-h);
  border-radius:20px;
  background:rgba(0,0,0,.35);
  overflow:hidden;
}

.pointer{
  position:absolute;
  top:0; left:50%;
  transform:translateX(-50%);
  width:0; height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-top:20px solid var(--red);
  z-index:10;
}

.prize-track{
  display:flex;
  align-items:center;
  height:100%;
  transition: transform 4s cubic-bezier(0.12,0,0.08,1);
  will-change: transform;
}

.prize-card{
  min-width:var(--card);
  width:var(--card);
  height:var(--card);
  margin:0 var(--card-gap);
  border-radius:22px;
  overflow:hidden;
  flex-shrink:0;
  background:transparent;
}

.prize-card img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:22px;
  user-select:none;
  -webkit-user-drag:none;
}

.controls{
  text-align:center;
  margin-top:20px;
}

#spin-btn{
  padding:15px 50px;
  font-size:18px;
  font-weight:900;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:var(--pink);
  color:#000;
  box-shadow:0 6px 0 #aa4696;
}

#spin-btn:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 #aa4696;
}

#spin-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

#modal-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(5px);
  align-items:center;
  justify-content:center;
  z-index:50;
  padding:16px;
}

#modal{
  width:90%;
  max-width:350px;
  background:#fff;
  border-radius:24px;
  padding:25px;
  text-align:center;
  color:#111;
  position:relative;
}

.promo-code{
  font-size:20px;
  font-weight:900;
  background:#f0f0f0;
  padding:15px;
  border-radius:12px;
  border:2px dashed #ccc;
  margin:15px 0;
  letter-spacing:.08em;
  word-break: break-word;
}

.copy-btn{
  padding:12px;
  border-radius:10px;
  font-weight:900;
  border:none;
  cursor:pointer;
  width:100%;
  background:var(--pink);
  color:#fff;
}

.copy-btn:active{ transform: translateY(1px); }

.toast{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:-14px;
  background:#111;
  color:#fff;
  padding:8px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease, bottom .25s ease;
  white-space:nowrap;
}

.toast.show{
  opacity:1;
  bottom:-6px;
}

/* ✅ Mobile tuning */
@media (max-width: 420px){
  .main{ padding:14px; }
  .header{ padding:18px 12px 8px; }
  .pointer{
    border-left:12px solid transparent;
    border-right:12px solid transparent;
    border-top:18px solid var(--red);
  }
  #spin-btn{
    width:100%;
    padding:14px 18px;
    font-size:16px;
  }
}
</style>
</head>

<body>

<div class="shell">
  <div class="header">
    <h1>GIRA Y GANA</h1>
  </div>

  <div class="main">
    <div class="carousel-container">
      <div class="pointer"></div>
      <div class="prize-track" id="track"></div>
    </div>

    <div class="controls">
      <button id="spin-btn" onclick="spinWheel()">GIRAR AHORA</button>
    </div>
  </div>
</div>

<div id="modal-overlay">
  <div class="modal" id="modal">
    <h2 style="margin:0">¡FELICIDADES!</h2>
    <div class="promo-code" id="promo-code"></div>
    <button class="copy-btn" id="copy-btn" type="button">COPIAR CÓDIGO</button>
    <div class="toast" id="toast">¡Copiado!</div>
  </div>
</div>

<script>
/** ======================
 *  CONFIG
 *  ====================== */
const FIXED_CODE  = "rbzSNb";               // ✅ NEW voucher code
const STORAGE_KEY = "vip_spin_locked_v2";   // ✅ bump version to avoid old saved result

const prizes = [
  { img:"https://ricomx.ft-crm.com/media-api/serve/1a457da2-bdef-4c84-8202-dc91887883d4_photo_6084903068915928886_x.jpg" }, // 5FS image
  { img:"https://ricomx.ft-crm.com/media-api/serve/c2b75030-9799-4956-958d-e22f7be3a408_photo_6084903068915928887_x.jpg" }, // 20FS image
  { img:"https://ricomx.ft-crm.com/media-api/serve/32ac2add-c52a-418f-9cf9-9fde69416566_photo_6084903068915928885_x.jpg" }, // 50FS image (forced)
  { img:"https://ricomx.ft-crm.com/media-api/serve/2f4f7c2d-2e7d-4151-b5f5-4691912d44ab_photo_6084903068915928884_x.jpg" }  // 100FS image
];

// ✅ ONLY x50 FREE SPINS is possible (index 2)
const FORCED_INDEX = 2;

/** ======================
 *  ELEMENTS
 *  ====================== */
const track = document.getElementById("track");
const spinBtn = document.getElementById("spin-btn");
const promoCodeEl = document.getElementById("promo-code");
const modalOverlay = document.getElementById("modal-overlay");
const copyBtn = document.getElementById("copy-btn");
const toast = document.getElementById("toast");

let cardWidth = 174;
let spinning = false;

/** ======================
 *  RESPONSIVE WIDTH CALC
 *  ====================== */
function computeCardWidth(){
  const first = track.querySelector(".prize-card");
  if(!first) return;
  const cs = getComputedStyle(first);
  const w = first.getBoundingClientRect().width;
  const ml = parseFloat(cs.marginLeft) || 0;
  const mr = parseFloat(cs.marginRight) || 0;
  cardWidth = w + ml + mr;
}

/** ======================
 *  STORAGE HELPERS
 *  ====================== */
function getSaved(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){ return null; }
}

function saveLocked(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      code: FIXED_CODE,
      ts: Date.now()
    }));
  }catch(e){}
}

/** ======================
 *  UI HELPERS
 *  ====================== */
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 1100);
}

function showModalWithCode(){
  promoCodeEl.innerText = FIXED_CODE;
  modalOverlay.style.display = "flex";
}

function lockUI(){
  spinBtn.disabled = true;
  spinBtn.textContent = "YA JUGASTE";
}

function lockToSavedResult(saved){
  lockUI();
  showModalWithCode();

  track.style.transition = "none";
  track.style.transform = "translateX(0)";
  spinning = false;
}

/** ======================
 *  INIT
 *  ====================== */
function init(){
  for(let i=0;i<80;i++){
    const prize = prizes[i % prizes.length];
    const card = document.createElement("div");
    card.className = "prize-card";
    card.innerHTML = `<img src="${prize.img}" alt="">`;
    track.appendChild(card);
  }

  computeCardWidth();
  window.addEventListener("resize", computeCardWidth);

  const saved = getSaved();
  if(saved && saved.code){
    lockToSavedResult(saved);
  }
}

/** ======================
 *  SPIN
 *  ====================== */
function spinWheel(){
  const saved = getSaved();
  if(saved && saved.code){
    lockToSavedResult(saved);
    return;
  }

  if(spinning) return;
  spinning = true;
  spinBtn.disabled = true;

  computeCardWidth();

  const base = 60 + Math.floor(Math.random() * 10); // 60..69
  const targetIndex = base - (base % prizes.length) + FORCED_INDEX;

  const containerWidth = document.querySelector(".carousel-container").offsetWidth;
  const centerPoint = containerWidth / 2;
  const finalOffset = (targetIndex * cardWidth) + (cardWidth / 2) - centerPoint;

  track.style.transition = "transform 4s cubic-bezier(0.12,0,0.08,1)";
  track.style.transform = `translateX(-${finalOffset}px)`;

  setTimeout(()=>{
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 },
      colors: ['#ff75e2', '#ffffff']
    });

    showModalWithCode();
    saveLocked();
    lockUI();
    spinning = false;
  }, 4100);
}

/** ======================
 *  COPY (robust for GitHub Pages / iOS)
 *  ====================== */
async function copyCode(){
  const text = FIXED_CODE;

  // 1) Clipboard API (works on https)
  try{
    if(navigator.clipboard && window.isSecureContext){
      await navigator.clipboard.writeText(text);
      showToast("¡Copiado!");
      return;
    }
  }catch(e){ /* fallback */ }

  // 2) Fallback: textarea + execCommand (older iOS / browsers)
  try{
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.setAttribute("readonly", "");
    ta.style.position = "fixed";
    ta.style.top = "-9999px";
    ta.style.left = "-9999px";
    ta.style.opacity = "0";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    const ok = document.execCommand("copy");
    document.body.removeChild(ta);

    if(ok) showToast("¡Copiado!");
    else showToast("Mantén presionado para copiar");
  }catch(e){
    showToast("Mantén presionado para copiar");
  }
}

/* ✅ ensure button always works */
copyBtn.addEventListener("click", copyCode);

init();
</script>

</body>
</html>
