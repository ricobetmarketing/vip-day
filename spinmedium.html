<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>VIP DAY - Spin & Win</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --pink:#ff75e2;
  --bg:#121125;
  --stroke: rgba(255,255,255,.12);
  --text:#f5f7ff;
  --red:#ff4d4d;
  --shadow: 0 22px 60px rgba(0,0,0,.55);
}

*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; margin:0; }

body{
  background:
    radial-gradient(900px 520px at 50% -10%, rgba(255,117,226,.18), transparent 60%),
    var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: system-ui, -apple-system, sans-serif;
  color:var(--text);
}

.shell{
  width:95%;
  max-width:800px;
  border:1px solid var(--stroke);
  border-radius:32px;
  box-shadow:var(--shadow);
  overflow:hidden;
  background:rgba(255,255,255,.04);
}

.header{
  text-align:center;
  padding:24px 15px 10px;
}

.header h1{
  margin:0;
  font-size: clamp(24px, 6vw, 40px);
  background: linear-gradient(180deg, #fff, var(--pink));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.main{ padding:20px; }

.carousel-container{
  position:relative;
  height:180px;
  border-radius:20px;
  background:rgba(0,0,0,.35);
  overflow:hidden;
}

.pointer{
  position:absolute;
  top:0; left:50%;
  transform:translateX(-50%);
  width:0; height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-top:20px solid var(--red);
  z-index:10;
}

.prize-track{
  display:flex;
  align-items:center;
  height:100%;
  transition: transform 4s cubic-bezier(0.12,0,0.08,1);
  will-change: transform;
}

.prize-card{
  min-width:150px;
  height:150px;
  margin:0 12px;
  border-radius:22px;
  overflow:hidden;
  flex-shrink:0;
  background:transparent;
}

.prize-card img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:22px;
  user-select:none;
  -webkit-user-drag:none;
}

.controls{
  text-align:center;
  margin-top:20px;
}

#spin-btn{
  padding:15px 50px;
  font-size:18px;
  font-weight:900;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:var(--pink);
  color:#000;
  box-shadow:0 6px 0 #aa4696;
}

#spin-btn:active{
  transform:translateY(4px);
  box-shadow:0 2px 0 #aa4696;
}

#spin-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

#modal-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(5px);
  align-items:center;
  justify-content:center;
  z-index:50;
}

#modal{
  width:90%;
  max-width:350px;
  background:#fff;
  border-radius:24px;
  padding:25px;
  text-align:center;
  color:#111;
}

.promo-code{
  font-size:20px;
  font-weight:900;
  background:#f0f0f0;
  padding:15px;
  border-radius:12px;
  border:2px dashed #ccc;
  margin:15px 0;
  letter-spacing:.08em;
}

.copy-btn{
  padding:12px;
  border-radius:10px;
  font-weight:900;
  border:none;
  cursor:pointer;
  width:100%;
  background:var(--pink);
  color:#fff;
}
</style>
</head>

<body>

<div class="shell">
  <div class="header">
    <h1>SPIN & WIN</h1>
  </div>

  <div class="main">
    <div class="carousel-container">
      <div class="pointer"></div>
      <div class="prize-track" id="track"></div>
    </div>

    <div class="controls">
      <button id="spin-btn" onclick="spinWheel()">SPIN NOW</button>
    </div>
  </div>
</div>

<div id="modal-overlay">
  <div class="modal" id="modal">
    <h2 style="margin:0">CONGRATS!</h2>
    <div class="promo-code" id="promo-code"></div>
    <button class="copy-btn" onclick="copyCode()">COPY CODE</button>
  </div>
</div>

<script>
/** ======================
 *  CONFIG
 *  ====================== */
const FIXED_CODE  = "rbzSNb";               // ✅ NEW voucher code
const STORAGE_KEY = "vip_spin_locked_v2";   // ✅ bump version to avoid old saved result

const prizes = [
  { img:"https://ricomx.ft-crm.com/media-api/serve/1a457da2-bdef-4c84-8202-dc91887883d4_photo_6084903068915928886_x.jpg" }, // 5FS image
  { img:"https://ricomx.ft-crm.com/media-api/serve/c2b75030-9799-4956-958d-e22f7be3a408_photo_6084903068915928887_x.jpg" }, // 20FS image
  { img:"https://ricomx.ft-crm.com/media-api/serve/32ac2add-c52a-418f-9cf9-9fde69416566_photo_6084903068915928885_x.jpg" }, // 50FS image (forced)
  { img:"https://ricomx.ft-crm.com/media-api/serve/2f4f7c2d-2e7d-4151-b5f5-4691912d44ab_photo_6084903068915928884_x.jpg" }  // 100FS image
];

// ✅ ONLY x50 FREE SPINS is possible (index 2)
const FORCED_INDEX = 2;

/** ======================
 *  ELEMENTS
 *  ====================== */
const track = document.getElementById("track");
const spinBtn = document.getElementById("spin-btn");
const promoCodeEl = document.getElementById("promo-code");
const modalOverlay = document.getElementById("modal-overlay");

const cardWidth = 174; // 150 + margins
let spinning = false;

/** ======================
 *  STORAGE HELPERS
 *  ====================== */
function getSaved(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    return JSON.parse(raw);
  }catch(e){ return null; }
}

function saveLocked(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      code: FIXED_CODE,
      ts: Date.now()
    }));
  }catch(e){}
}

/** ======================
 *  UI HELPERS
 *  ====================== */
function showModalWithCode(){
  promoCodeEl.innerText = FIXED_CODE;
  modalOverlay.style.display = "flex";
}

function lockUI(){
  spinBtn.disabled = true;
  spinBtn.textContent = "ALREADY PLAYED";
}

function lockToSavedResult(saved){
  lockUI();
  showModalWithCode();

  track.style.transition = "none";
  track.style.transform = "translateX(0)";
  spinning = false;
}

/** ======================
 *  INIT
 *  ====================== */
function init(){
  for(let i=0;i<80;i++){
    const prize = prizes[i % prizes.length];
    const card = document.createElement("div");
    card.className = "prize-card";
    card.innerHTML = `<img src="${prize.img}" alt="">`;
    track.appendChild(card);
  }

  const saved = getSaved();
  if(saved && saved.code){
    lockToSavedResult(saved);
  }
}

/** ======================
 *  SPIN
 *  ====================== */
function spinWheel(){
  const saved = getSaved();
  if(saved && saved.code){
    lockToSavedResult(saved);
    return;
  }

  if(spinning) return;
  spinning = true;
  spinBtn.disabled = true;

  // pick a target index (60..69) that maps to FORCED_INDEX
  const base = 60 + Math.floor(Math.random() * 10); // 60..69
  const targetIndex = base - (base % prizes.length) + FORCED_INDEX;

  const containerWidth = document.querySelector(".carousel-container").offsetWidth;
  const centerPoint = containerWidth / 2;
  const finalOffset = (targetIndex * cardWidth) + (cardWidth / 2) - centerPoint;

  track.style.transition = "transform 4s cubic-bezier(0.12,0,0.08,1)";
  track.style.transform = `translateX(-${finalOffset}px)`;

  setTimeout(()=>{
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 },
      colors: ['#ff75e2', '#ffffff']
    });

    showModalWithCode();
    saveLocked();
    lockUI();
    spinning = false;
  }, 4100);
}

/** ======================
 *  COPY
 *  ====================== */
function copyCode(){
  navigator.clipboard.writeText(FIXED_CODE).catch(()=>{});
}

init();
</script>

</body>
</html>
